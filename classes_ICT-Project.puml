@startuml classes_ICT-Project
set namespaceSeparator none
skinparam linetype ortho
skinparam classAttributeIconSize 0
skinparam classFontSize 10
skinparam classFontName "Courier New"
skinparam classArrowFontSize 10
skinparam packageStyle rectangle
skinparam wrapWidth 160
skinparam maxMessageSize 60
top to bottom direction
scale 0.85
skinparam class {
  BackgroundColor lightblue
  BorderColor darkblue
}
skinparam package {
  BackgroundColor lightgray
  BorderColor darkgray
}

package "View" {
  class "DeleteArea" as src.view.DeleteArea.DeleteArea {
    gridWidget
    dragEnterEvent(event)
    dropEvent(event)
  }

  class "GridWidget" as src.view.GridWidget.GridWidget {
    cols : int
    connections : list
    draggingLine : DraggingLine
    items : dict
    rows : int
    addItem(cell, widget)
    cellAt(pos)
    removeItem(uid)
    startConnection(item, port, event)
  }

  class "PaletteItem" as src.view.PaletteItem.PaletteItem {
    componentName : str
    color
    mousePressEvent(event)
  }

  class "SimulationControls" as src.view.SimulationControls.SimulationControls {
    resetButton
    speedSlider
    startStopButton
    addButton(label, handler, index)
    configureReset(handler)
    updateSpeedLabel(value)
  }

  class "LogicComponentPalette" as src.view.LogicComponentPalette.LogicComponentPalette {
    createCollapsibleSections()
  }

  class "CustomComponentPaletteItem" as src.view.CustomComponentPaletteItem.CustomComponentPaletteItem {
    componentData : CustomLogicComponentData
    getImagePath() : str
    getPayload()
  }

  class "Connection" as src.view.Connection.Connection {
    dstItem
    dstKey : str
    isActive : bool
    srcItem
    srcKey : str
    getPath()
    setPath(path)
  }

  class "DraggingLine" as src.view.DraggingLine.DraggingLine {
    currentPos
    srcItem
    srcKey : str
    startPos
  }

  class "CreateCustomComponentDialog" as src.view.CreateCustomComponentDialog.CreateCustomComponentDialog {
    logicController : LogicComponentController
    spritePath : str
    submitForm()
    toggleHelp()
  }

  class "Hint" as src.view.Hint.Hint {
    current_hint_index : int
    levelController : LevelController
    change_icon()
    show_hint()
  }

  class "LevelScene" as src.view.LevelScene.LevelScene {
    backButton
    grid : GridWidget
    levelController : LevelController
    levelData : dict
    levelFileController : LevelFileController
    checkSolution()
    goToLevelSelection()
  }

  class "LevelSelectionScene" as src.view.LevelSelectionScene.LevelSelectionScene {
    bus
    grid
    levelButtons : list
    levelFileController : LevelFileController
    toggleLevelLockButton
    createLevelButtons()
    toggleLevelLock()
  }

  class "MainScene" as src.view.MainScene.MainScene {
    bus
    closeApplication()
  }

  class "OutputPrediction" as src.view.OutputPrediction.OutputPrediction {
    levelController : LevelController
    enterPrediction(fromInput, bitwidth, index)
  }

  class "SandboxModeScene" as src.view.SandboxModeScene.SandboxModeScene {
    bus
    grid : GridWidget
    logicController : LogicComponentController
    goToMain()
    openCreateCustomComponentDialog()
  }

  package "Grid Items" {
    class "WrapAnywhereLabel" as src.view.GridItems.GridItem.WrapAnywhereLabel {
      text : str
      setText(text)
      setScaleFactor(scale)
    }

    class "GridItem" as src.view.GridItems.GridItem.GridItem {
      bus
      immovable : bool
      inputs : dict
      logicComponent : LogicComponent
      outputLabels : dict
      outputs : dict
      uid : str
      deleteItem()
      openContextMenu()
      portAt(pos)
      updatePortLabels()
    }

    class "GridItemFactory" as src.view.GridItems.GridItemFactory.GridItemFactory {
      {static}createGridItem(component, **kwargs) : GridItem
    }

    class "InputGridItem" as src.view.GridItems.InputGridItem.InputGridItem {
    }

    class "HalfAdderGridItem" as src.view.GridItems.HalfAdderGridItem.HalfAdderGridItem {
    }

    class "FullAdderGridItem" as src.view.GridItems.FullAdderGridItem.FullAdderGridItem {
    }

    class "ALUSimpleGridItem" as src.view.GridItems.ALUSimpleGridItem.ALUSimpleGridItem {
    }

    class "ALUAdvancedGridItem" as src.view.GridItems.ALUAdvancedGridItem.ALUAdvancedGridItem {
    }

    class "Multiplexer2InpGridItem" as src.view.GridItems.Multiplexer2InpGridItem.Multiplexer2InpGridItem {
    }

    class "Multiplexer4InpGridItem" as src.view.GridItems.Multiplexer4InpGridItem.Multiplexer4InpGridItem {
    }

    class "Multiplexer8InpGridItem" as src.view.GridItems.Multiplexer8InpGridItem.Multiplexer8InpGridItem {
    }

    class "CustomComponentGridItem" as src.view.GridItems.CustomComponentGridItem.CustomComponentGridItem {
      getImagePath() : str
      getName() : str
      showComponentTooltip()
    }

    class "DataMemoryGridItem" as src.view.GridItems.DataMemoryGridItem.DataMemoryGridItem {
    }
  }
}

package "Control" {
  package "Infrastructure" {
    class "EventBus" as src.infrastructure.eventBus.EventBus {
      manual : bool
      emit(event, *payload)
      setAuto()
      setManual()
      subscribe(event, handler)
      unsubscribe(event, handler)
    }
  }

  class "AppController" as src.control.AppController.AppController {
    app : QApplication
    bus
    logicController : LogicComponentController
    levelController : LevelController
    levelFileController : LevelFileController
    window : QMainWindow
    run()
    switchToScene(scene)
    onLevelSelected(levelNumber)
  }

  class "LogicComponentController" as src.control.LogicComponentController.LogicComponentController {
    bus
    components : typing.List['LogicComponent']
    dataMemory : DataMemory
    inputs : typing.List['Input']
    instructionMemory : InstructionMemory
    outputs : typing.List['LogicComponent']
    registerBlock : RegisterBlock
    tickLength : float
    updateInTick : typing.Dict
    addConnection(origin, originKey, target, targetKey) : bool
    addCustomLogicComponent(componentData) : LogicComponent
    addLogicComponent(component) : LogicComponent
    clearComponents()
    eval() : bool
    removeLogicComponent(component)
    setTickLength(length)
    updateComponents(**tickList)
    updateRegisters()
  }

  class "CustomComponentController" as src.control.CustomComponentController.CustomComponentController {
    {static}createCustomComponent(data) : bool
    {static}loadCustomComponents() : List
  }

  class "LevelController" as src.control.LevelController.LevelController {
    currentLevel
    eventBus
    grid
    levelData : dict
    logicComponentController : LogicComponentController
    outputPredictions : list
    buildLevel()
    checkSolution() : bool
    usesOutputPredictions() : bool
  }

  class "LevelFileController" as src.control.LevelFileController.LevelFileController {
    currentLevel
    path : str
    getAvailableLevels() : List[int]
    loadLevel(levelNumber) : dict
    loadMetaFile() : dict
    updateCompletedLevels(levelId)
  }
}

package "Model - Core" {
  abstract class "LogicComponent" as src.model.LogicComponent.LogicComponent {
    bus
    id : int
    inputBitwidths : typing.Dict
    inputs : typing.Dict
    label : str
    outputs : typing.List[tuple]
    state : dict
    addInput(input, key, internalKey) : bool
    addOutput(output, key)
    {abstract}eval() : bool
    getBitwidth(key) : int
    getInputs() : typing.Dict
    getOutputs() : typing.List[tuple]
    getState() : dict
    removeInput(input, key, internalKey)
    removeOutput(output, key)
    setLabel(label)
  }

  class "Input" as src.model.Input.Input {
    inputs : dict
    outputBitwidth : int
    outputs : typing.List['LogicComponent']
    state : dict
    eval() : bool
    setState(state)
    toggleState()
  }

  class "Output" as src.model.Output.Output {
    inputBitwidths : typing.Dict
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "CustomLogicComponent" as src.model.CustomLogicComponent.CustomLogicComponent {
    childComponents : list
    customComponentName : str
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "CustomLogicComponentData" as src.model.CustomLogicComponentData.CustomLogicComponentData {
    name : str
    inputMap : Dict[str, int]
    outputMap : Dict[str, int]
    components : List[str]
    connections : List
  }
}

package "Model - Basic Logic" #lightgreen {
  class "And" as src.model.And.And {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Or" as src.model.Or.Or {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Not" as src.model.Not.Not {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Nand" as src.model.Nand.Nand {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Nor" as src.model.Nor.Nor {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Xor" as src.model.Xor.Xor {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Xnor" as src.model.Xnor.Xnor {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }
}

package "Model - Advanced Logic" #lightyellow {
  class "ALUAdvanced" as src.model.ALUAdvanced.ALUAdvanced {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "ALUSimple" as src.model.ALUSimple.ALUSimple {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Adder32bit" as src.model.Adder32bit.Adder32bit {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "FullAdder" as src.model.FullAdder.FullAdder {
    inputs : dict
    state : dict
    eval() : bool
  }

  class "HalfAdder" as src.model.HalfAdder.HalfAdder {
    inputs : dict
    state : dict
    eval() : bool
  }

  class "DecoderThreeBit" as src.model.DecoderThreeBit.DecoderThreeBit {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "DLatch" as src.model.DLatch.DLatch {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }
}

package "Model - Memory & Control" #lightgoldenrodyellow {
  class "Register" as src.model.Register.Register {
    inputs : typing.Dict
    nextState : tuple
    state : dict
    eval() : bool
    updateState() : bool
  }

  class "RegisterBlock" as src.model.RegisterBlock.RegisterBlock {
    inputs : typing.Dict
    registers : typing.List[int]
    state : dict
    eval() : bool
    updateRegisterValues()
  }

  class "ProgramCounter" as src.model.ProgramCounter.ProgramCounter {
    bus
    inputs : typing.Dict
    maxValue : int
    state : dict
    eval() : bool
    onInstructionCount(count)
  }

  class "DataMemory" as src.model.DataMemory.DataMemory {
    dataList : typing.List[int]
    inputs : typing.Dict
    state : dict
    eval() : bool
    loadData(data)
  }

  class "InstructionMemory" as src.model.InstructionMemory.InstructionMemory {
    inputs : typing.Dict
    instructionList : typing.List[int]
    state : dict
    eval() : bool
    loadInstructions(instructions)
  }

  class "ControlUnit" as src.model.ControlUnit.ControlUnit {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "ALUControl" as src.model.ALUControl.ALUControl {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }
}

package "Model - Data Processing" #lightcoral {
  class "Collector1to2" as src.model.Collector1to2.Collector1to2 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Collector1to3" as src.model.Collector1to3.Collector1to3 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Collector1to5" as src.model.Collector1to5.Collector1to5 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Collector1to6" as src.model.Collector1to6.Collector1to6 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Collector1to8" as src.model.Collector1to8.Collector1to8 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Collector8to16" as src.model.Collector8to16.Collector8to16 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Collector8to32" as src.model.Collector8to32.Collector8to32 {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Splitter32to8" as src.model.Splitter32to8.Splitter32to8 {
    inputs : typing.Dict
    state : dict
    eval()
  }

  class "Splitter8to1" as src.model.Splitter8to1.Splitter8to1 {
    inputs : typing.Dict
    state : dict
    eval()
  }

  class "ShiftLeft2" as src.model.ShiftLeft2.ShiftLeft2 {
    inputs : typing.Dict
    state : dict
    addInput(input, key, internalKey)
    addOutput(output, key)
    eval() : bool
    removeInput(input, key, internalKey)
    removeOutput(output, key)
  }

  class "SignExtend" as src.model.SignExtend.SignExtend {
    inputs : typing.Dict
    state : dict
    eval() : bool
  }

  class "Multiplexer2Inp" as src.model.Multiplexer2Input.Multiplexer2Inp {
    inputs : typing.Dict
    state : typing.Dict
    addInput(input, key, internalKey) : bool
    addOutput(output, key) : bool
    eval() : bool
    getOutputBitwidth() : int
    removeInput(input, key, internalKey) : bool
    removeOutput(output, key) : bool
  }

  class "Multiplexer4Inp" as src.model.Multiplexer4Input.Multiplexer4Inp {
    inputs : typing.Dict
    state : typing.Dict
    addInput(input, key, internalKey) : bool
    addOutput(output, key) : bool
    eval() : bool
    getOutputBitwidth() : int
    removeInput(input, key, internalKey) : bool
    removeOutput(output, key) : bool
  }

  class "Multiplexer8Inp" as src.model.Multiplexer8Input.Multiplexer8Inp {
    inputs : typing.Dict
    state : typing.Dict
    addInput(input, key, internalKey) : bool
    addOutput(output, key) : bool
    eval() : bool
    getOutputBitwidth() : int
    removeInput(input, key, internalKey) : bool
    removeOutput(output, key) : bool
  }
}

package "Algorithms" {
  class "Algorithms" as src.Algorithms.Algorithms {
    {static}eventDrivenEval(inputs, components, updateFunction, waitFunction, **kw) : bool
    {static}khanFrontierEval(inputs, components, updateFunction, waitFunction) : bool
  }
}

' Inheritance relationships
src.view.CustomComponentPaletteItem.CustomComponentPaletteItem --|> src.view.PaletteItem.PaletteItem
src.view.GridItems.InputGridItem.InputGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.HalfAdderGridItem.HalfAdderGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.FullAdderGridItem.FullAdderGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.ALUSimpleGridItem.ALUSimpleGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.ALUAdvancedGridItem.ALUAdvancedGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.Multiplexer2InpGridItem.Multiplexer2InpGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.Multiplexer4InpGridItem.Multiplexer4InpGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.Multiplexer8InpGridItem.Multiplexer8InpGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.CustomComponentGridItem.CustomComponentGridItem --|> src.view.GridItems.GridItem.GridItem
src.view.GridItems.DataMemoryGridItem.DataMemoryGridItem --|> src.view.GridItems.GridItem.GridItem

src.model.CustomLogicComponent.CustomLogicComponent --|> src.model.LogicComponent.LogicComponent
src.model.Input.Input --|> src.model.LogicComponent.LogicComponent
src.model.Output.Output --|> src.model.LogicComponent.LogicComponent
src.model.And.And --|> src.model.LogicComponent.LogicComponent
src.model.Or.Or --|> src.model.LogicComponent.LogicComponent
src.model.Not.Not --|> src.model.LogicComponent.LogicComponent
src.model.Nand.Nand --|> src.model.LogicComponent.LogicComponent
src.model.Nor.Nor --|> src.model.LogicComponent.LogicComponent
src.model.Xor.Xor --|> src.model.LogicComponent.LogicComponent
src.model.Xnor.Xnor --|> src.model.LogicComponent.LogicComponent
src.model.ALUAdvanced.ALUAdvanced --|> src.model.LogicComponent.LogicComponent
src.model.ALUSimple.ALUSimple --|> src.model.LogicComponent.LogicComponent
src.model.Adder32bit.Adder32bit --|> src.model.LogicComponent.LogicComponent
src.model.FullAdder.FullAdder --|> src.model.LogicComponent.LogicComponent
src.model.HalfAdder.HalfAdder --|> src.model.LogicComponent.LogicComponent
src.model.DecoderThreeBit.DecoderThreeBit --|> src.model.LogicComponent.LogicComponent
src.model.DLatch.DLatch --|> src.model.LogicComponent.LogicComponent
src.model.Register.Register --|> src.model.LogicComponent.LogicComponent
src.model.RegisterBlock.RegisterBlock --|> src.model.LogicComponent.LogicComponent
src.model.ProgramCounter.ProgramCounter --|> src.model.LogicComponent.LogicComponent
src.model.DataMemory.DataMemory --|> src.model.LogicComponent.LogicComponent
src.model.InstructionMemory.InstructionMemory --|> src.model.LogicComponent.LogicComponent
src.model.ControlUnit.ControlUnit --|> src.model.LogicComponent.LogicComponent
src.model.ALUControl.ALUControl --|> src.model.LogicComponent.LogicComponent
src.model.Collector1to2.Collector1to2 --|> src.model.LogicComponent.LogicComponent
src.model.Collector1to3.Collector1to3 --|> src.model.LogicComponent.LogicComponent
src.model.Collector1to5.Collector1to5 --|> src.model.LogicComponent.LogicComponent
src.model.Collector1to6.Collector1to6 --|> src.model.LogicComponent.LogicComponent
src.model.Collector1to8.Collector1to8 --|> src.model.LogicComponent.LogicComponent
src.model.Collector8to16.Collector8to16 --|> src.model.LogicComponent.LogicComponent
src.model.Collector8to32.Collector8to32 --|> src.model.LogicComponent.LogicComponent
src.model.Splitter32to8.Splitter32to8 --|> src.model.LogicComponent.LogicComponent
src.model.Splitter8to1.Splitter8to1 --|> src.model.LogicComponent.LogicComponent
src.model.ShiftLeft2.ShiftLeft2 --|> src.model.LogicComponent.LogicComponent
src.model.SignExtend.SignExtend --|> src.model.LogicComponent.LogicComponent
src.model.Multiplexer2Input.Multiplexer2Inp --|> src.model.LogicComponent.LogicComponent
src.model.Multiplexer4Input.Multiplexer4Inp --|> src.model.LogicComponent.LogicComponent
src.model.Multiplexer8Input.Multiplexer8Inp --|> src.model.LogicComponent.LogicComponent

' Composition / aggregation
src.infrastructure.eventBus.EventBus --* src.control.LogicComponentController.LogicComponentController : bus
src.infrastructure.eventBus.EventBus --* src.model.LogicComponent.LogicComponent : bus
src.control.AppController.AppController --* src.control.LogicComponentController.LogicComponentController : logicController
src.control.AppController.AppController --* src.control.LevelController.LevelController : levelController
src.control.AppController.AppController --* src.control.LevelFileController.LevelFileController : levelFileController
src.control.LevelController.LevelController --* src.control.LogicComponentController.LogicComponentController : logicComponentController
src.view.SandboxModeScene.SandboxModeScene --* src.view.GridWidget.GridWidget : grid

' Layout hints
src.control.AppController.AppController -down-> src.control.LogicComponentController.LogicComponentController
src.control.LogicComponentController.LogicComponentController -down-> src.model.LogicComponent.LogicComponent
src.model.LogicComponent.LogicComponent -down-> src.model.Input.Input
src.model.LogicComponent.LogicComponent -down-> src.model.Output.Output
@enduml
